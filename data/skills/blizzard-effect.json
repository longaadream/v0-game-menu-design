{"id":"blizzard-effect","name":"暴风雪效果","description":"处理暴风雪区域的伤害和冰冻效果","kind":"passive","type":"normal","cooldownTurns":0,"maxCharges":0,"powerMultiplier":1,"actionPointCost":0,"code":"function executeSkill(context) { if (!context.battle.blizzardAreas || context.battle.blizzardAreas.length === 0) { return { message: '没有暴风雪区域', success: false }; } if (!context.playerId) { return { message: '没有玩家信息', success: false }; } let totalDamage = 0; let totalEnemies = 0; let enemyNames = []; let blizzardDetails = []; let casterPlayerId = null; context.battle.blizzardAreas.forEach(blizzardArea => { const caster = context.battle.pieces.find(p => p.instanceId === blizzardArea.casterId); if (caster) { casterPlayerId = caster.ownerPlayerId; } }); if (!casterPlayerId) { return { message: '没有找到施法者', success: false }; } if (casterPlayerId === context.playerId) { return { message: '暴风雪只在对方回合结束时触发', success: false }; } context.battle.blizzardAreas.forEach(blizzardArea => { const enemiesInArea = context.battle.pieces.filter(piece => { if (piece.ownerPlayerId === casterPlayerId) return false; const distanceX = Math.abs(piece.x - blizzardArea.center.x); const distanceY = Math.abs(piece.y - blizzardArea.center.y); return distanceX <= blizzardArea.radius && distanceY <= blizzardArea.radius && piece.currentHp > 0; }); enemiesInArea.forEach(enemy => { const caster = context.battle.pieces.find(p => p.instanceId === blizzardArea.casterId) || context.battle.pieces.find(p => p.ownerPlayerId === casterPlayerId); if (caster) { const damageResult = dealDamage(caster, enemy, blizzardArea.damage, 'magical', context.battle, 'blizzard'); if (typeof addStatusEffectById === 'function' && damageResult.success) { addStatusEffectById(enemy.instanceId, 'freeze', 1); enemy.showFreezeEffect = true; } totalDamage += damageResult.damage; totalEnemies++; enemyNames.push(enemy.templateId); } }); blizzardDetails.push('中心(' + blizzardArea.center.x + ',' + blizzardArea.center.y + ')'); if (!context.battle.effects) { context.battle.effects = []; } for (let x = blizzardArea.center.x - blizzardArea.radius; x <= blizzardArea.center.x + blizzardArea.radius; x++) { for (let y = blizzardArea.center.y - blizzardArea.radius; y <= blizzardArea.center.y + blizzardArea.radius; y++) { context.battle.effects.push({ type: 'blizzard', position: { x, y }, duration: 1, zIndex: 999, showOnUI: true }); } } }); context.battle.blizzardAreas = []; let message = '暴风雪效果'; if (blizzardDetails.length > 0) { message += '（中心格子：' + blizzardDetails.join(', ') + '）'; } if (totalEnemies > 0) { message += '对'; if (enemyNames.length > 0) { message += enemyNames.join('、'); } message += '造成了' + totalDamage + '点伤害并使其冰冻'; } else { message += '没有对任何敌人造成伤害'; } return { message: message, success: true, showUIEffects: true }; }","range":"area","areaSize":3,"requiresTarget":false,"showInUI":false}