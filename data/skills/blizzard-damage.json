{
  "id": "blizzard-damage",
  "name": "暴风雪伤害",
  "description": "对暴风雪区域内的所有敌人造成伤害和冰冻",
  "kind": "passive",
  "type": "normal",
  "cooldownTurns": 0,
  "maxCharges": 0,
  "powerMultiplier": 1,
  "actionPointCost": 0,
  "code": "function executeSkill(context) {\n    const sourcePiece = context.piece;\n    if (!sourcePiece.statusEffects) {\n      return { message: '没有状态效果', success: false };\n    }\n    // 找到暴风雪状态\n    const blizzardStatus = sourcePiece.statusEffects.find(effect => effect.type === 'blizzard');\n    if (!blizzardStatus) {\n      return { message: '没有暴风雪状态', success: false };\n    }\n    // 获取暴风雪中心位置和伤害\n    const centerX = blizzardStatus.value;\n    const centerY = blizzardStatus.extraValue;\n    const damageValue = blizzardStatus.damage;\n    if (centerX === undefined || centerY === undefined || damageValue === undefined) {\n      return { message: '暴风雪状态数据不完整', success: false };\n    }\n    // 只在对方回合结束时触发\n    if (context.playerId === sourcePiece.ownerPlayerId) {\n      return { message: '暴风雪只在对方回合结束时触发', success: false };\n    }\n    const radius = 1;\n    let totalDamage = 0;\n    let totalEnemies = 0;\n    let enemyNames = [];\n    // 找到区域内所有敌人\n    const enemiesInArea = context.battle.pieces.filter(piece => {\n      if (piece.ownerPlayerId === sourcePiece.ownerPlayerId) return false;\n      if (piece.currentHp <= 0) return false;\n      const distanceX = Math.abs(piece.x - centerX);\n      const distanceY = Math.abs(piece.y - centerY);\n      return distanceX <= radius && distanceY <= radius;\n    });\n    // 对每个敌人造成伤害和冰冻\n    enemiesInArea.forEach(enemy => {\n      const damageResult = dealDamage(sourcePiece, enemy, damageValue, 'magical', context.battle, 'blizzard');\n      if (damageResult.success) {\n        // 添加冰冻状态\n        if (typeof addStatusEffectById === 'function') {\n          const statusId = 'freeze-' + Date.now() + '-' + enemy.instanceId;\n          addStatusEffectById(enemy.instanceId, { id: statusId, type: 'freeze', currentDuration: 1, intensity: 1 });\n        }\n        // 添加冰冻规则\n        if (typeof addRuleById === 'function') {\n          addRuleById(enemy.instanceId, 'rule-freeze-prevent-move');\n          addRuleById(enemy.instanceId, 'rule-freeze-prevent-skill');\n        }\n        // 添加冰冻技能\n        if (typeof addSkillById === 'function') {\n          addSkillById(enemy.instanceId, 'freeze-prevent');\n        }\n        enemy.showFreezeEffect = true;\n        totalDamage += damageResult.damage;\n        totalEnemies++;\n        enemyNames.push(enemy.name);\n      }\n    });\n    // 添加视觉效果\n    if (!context.battle.effects) {\n      context.battle.effects = [];\n    }\n    for (let x = centerX - radius; x <= centerX + radius; x++) {\n      for (let y = centerY - radius; y <= centerY + radius; y++) {\n        context.battle.effects.push({ type: 'blizzard', position: { x, y }, duration: 1, zIndex: 999, showOnUI: true });\n      }\n    }\n    // 移除自身的暴风雪状态、规则和技能\n    if (typeof removeStatusEffectById === 'function') {\n      removeStatusEffectById(sourcePiece.instanceId, blizzardStatus.id);\n    }\n    if (typeof removeRuleById === 'function') {\n      removeRuleById(sourcePiece.instanceId, 'rule-blizzard-active');\n    }\n    if (typeof removeSkillById === 'function') {\n      removeSkillById(sourcePiece.instanceId, 'blizzard-damage');\n    }\n    // 构建消息\n    let message = sourcePiece.name + '的暴风雪效果';\n    message += '（中心坐标：(' + centerX + ',' + centerY + ')）';\n    if (totalEnemies > 0) {\n      message += '对' + enemyNames.join('、') + '造成了' + totalDamage + '点伤害并使其冰冻';\n    } else {\n      message += '没有对任何敌人造成伤害';\n    }\n    return { message: message, success: true, showUIEffects: true };\n  }",
  "showInUI": false
}
