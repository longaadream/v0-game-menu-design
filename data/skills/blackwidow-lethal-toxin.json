{
  "id": "blackwidow-lethal-toxin",
  "name": "致命毒素",
  "description": "在自己当前的格子放置一个毒素，并向随机方向移动一格，敌人碰到毒素时受到4点伤害。",
  "icon": "☠️",
  "kind": "active",
  "type": "normal",
  "cooldownTurns": 2,
  "maxCharges": 0,
  "powerMultiplier": 1,
  "actionPointCost": 2,
  "code": "function executeSkill(context) { var caster = context.piece; console.log('[LethalToxin] Starting, caster:', caster.name, 'at', caster.x, caster.y); var directions = [{ x: 0, y: -1 }, { x: 0, y: 1 }, { x: -1, y: 0 }, { x: 1, y: 0 }]; var validMoves = []; for (var i = 0; i < directions.length; i++) { var newX = caster.x + directions[i].x; var newY = caster.y + directions[i].y; var occupied = context.battle.pieces.some(function(p) { return p.x === newX && p.y === newY && p.currentHp > 0; }); console.log('[LethalToxin] Check move to:', newX, newY, 'occupied:', occupied); if (!occupied) { validMoves.push({ x: newX, y: newY }); } } if (validMoves.length === 0) { return { success: false, message: '没有可移动的格子' }; } var randomIndex = Math.floor(Math.random() * validMoves.length); var newPos = validMoves[randomIndex]; var toxinX = caster.x; var toxinY = caster.y; console.log('[LethalToxin] Placing toxin at:', toxinX, toxinY); console.log('[LethalToxin] Moving to:', newPos.x, newPos.y); var toxinId = 'lethal-toxin-' + Date.now(); console.log('[LethalToxin] Adding status effect with id:', toxinId); addStatusEffectById(caster.instanceId, { id: toxinId, type: 'lethal-toxin', currentDuration: 3, currentUses: -1, intensity: 4, value: toxinX, extraValue: toxinY, relatedRules: ['rule-blackwidow-toxin-trigger'] }); console.log('[LethalToxin] Status tags after add:', caster.statusTags); console.log('[LethalToxin] Adding rule'); addRuleById(caster.instanceId, 'rule-blackwidow-toxin-trigger'); console.log('[LethalToxin] Rules after add:', caster.rules); caster.x = newPos.x; caster.y = newPos.y; console.log('[LethalToxin] Moved, new position:', caster.x, caster.y); return { success: true, message: caster.name + '在原位置(' + toxinX + ',' + toxinY + ')放置了毒素，并移动到了(' + newPos.x + ',' + newPos.y + ')' }; }",
  "previewCode": "function calculatePreview(piece, skillDef) { return { description: '在当前格子放置毒素，向随机方向移动一格，敌人触碰毒素受到4点伤害', expectedValues: { damage: 4 } }; }"
}
